{% comment %} 
  Unified workshop listing template
  Parameters:
    - category: Filter by workshop category (optional)
    - show_pathways: Show pathway buttons (default: false)
    - pathway_url: URL for pathway button
    - pathway_title: Title for pathway button
{% endcomment %}

{% comment %} Default parameter values {% endcomment %}
{% assign show_pathways = include.show_pathways | default: false %}

{% comment %} No longer displaying a separate Currently Available section since we have available-now.html {% endcomment %}

{% comment %} Display all workshops with active ones highlighted {% endcomment %}
<div class="row mb-4">
  <div class="col-12">
    <h3>
      <i class="fas fa-list"></i> Workshop Catalog
    </h3>
    <p class="text-muted">Browse all available workshops. <span class="text-success"><i class="fas fa-circle"></i> Green dots</span> indicate workshops with upcoming sessions.</p>
  </div>
</div>
<div class="row">
  {% comment %} Sort by difficulty: introductory, intermediate, advanced {% endcomment %}
  {% assign difficulty_levels = "introductory,intermediate,advanced" | split: "," %}
  
  {% for level in difficulty_levels %}
    {% comment %} Check if there are any workshops at this level first {% endcomment %}
    {% assign level_has_workshops = false %}
    {% for workshop in site.data.workshops.workshops %}
      {% include category-match.html workshop=workshop category=include.category %}
      {% if category_match and workshop.level == level %}
        {% assign level_has_workshops = true %}
        {% break %}
      {% endif %}
    {% endfor %}
    
    {% if level_has_workshops %}
      {% comment %} Add section header for this difficulty level {% endcomment %}
      <div class="row mb-3 mt-4">
        <div class="col-12">
          {% if level == 'introductory' %}
            <h4 class="text-success mb-0">
              <i class="fas fa-seedling"></i> Introductory Workshops
            </h4>
            <small class="text-muted">Perfect for beginners - no prior experience required</small>
          {% elsif level == 'intermediate' %}
            <h4 class="text-warning mb-0">
              <i class="fas fa-layer-group"></i> Intermediate Workshops
            </h4>
            <small class="text-muted">Build on foundational knowledge with more advanced topics</small>
          {% elsif level == 'advanced' %}
            <h4 class="text-danger mb-0">
              <i class="fas fa-rocket"></i> Advanced Workshops
            </h4>
            <small class="text-muted">Specialized topics for experienced practitioners</small>
          {% endif %}
        </div>
      </div>
      
      {% comment %} Show workshops for this level {% endcomment %}
      <div class="row mb-5">
        {% for workshop in site.data.workshops.workshops %}
          {% include category-match.html workshop=workshop category=include.category %}
          {% if category_match %}
            {% assign is_active = false %}
            {% assign workshop_title_lower = workshop.title | downcase %}
            
            {% for upcoming in site.data.upcoming_workshops.workshops %}
              {% comment %} Skip non-registrable workshop parts {% endcomment %}
              {% if upcoming.title contains ": Part 2" or upcoming.title contains ": Part 3" or upcoming.title contains ": Part 4" or upcoming.title contains ": Part 5" or upcoming.title contains ": Part 6" %}
                {% continue %}
              {% endif %}
              
              {% assign upcoming_title_lower = upcoming.title | downcase %}
              {% comment %} Use same flexible matching logic as before {% endcomment %}
              {% if upcoming_title_lower == workshop_title_lower or upcoming_title_lower contains workshop_title_lower or workshop_title_lower contains upcoming_title_lower %}
                {% assign is_active = true %}
                {% break %}
              {% endif %}
            {% endfor %}
            
            {% comment %} Show ALL workshops of this level, pass active status to card {% endcomment %}
            {% if workshop.level == level %}
              {% include workshop-card.html workshop=workshop is_active=is_active %}
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endfor %}
</div>

{% comment %} Add pathway button at the bottom if show_pathways is true {% endcomment %}
{% if show_pathways and include.pathway_url and include.pathway_title %}
  <div class="row mb-5 mt-4">
    <div class="col-12 text-center">
      <div class="card border-0 bg-light">
        <div class="card-body py-4">
          <h5 class="card-title mb-3">
            Need help choosing your next workshop?
          </h5>
          <p class="text-muted mb-3">
            See how workshops build on each other and discover the perfect learning pathway for your goals.
          </p>
          <a href="{{ include.pathway_url }}" class="btn btn-primary btn-lg">
            <i class="fas fa-route"></i> {{ include.pathway_title }}
          </a>
        </div>
      </div>
    </div>
  </div>
{% endif %}