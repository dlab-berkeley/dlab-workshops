<div class="col-md-6 col-lg-4 mb-4">
  <a href="{{ workshop.title | slugify | prepend: '/workshop/' | relative_url }}" class="text-decoration-none">
    <div class="card h-100 workshop-card border-0 shadow-sm clickable-card" data-workshop-title="{{ workshop.title }}">
    <div class="card-body d-flex flex-column">
      <div class="d-flex justify-content-between align-items-start mb-2">
        <div class="flex-grow-1">
          <h5 class="card-title mb-1">{{ workshop.title }}</h5>
          {% if workshop.duration %}
          <small class="text-muted">
            <i class="fas fa-clock"></i> 
            {% if workshop.title contains "Parts" or workshop.title contains "Part" %}
              {{ workshop.duration }} per session
            {% else %}
              {{ workshop.duration }}
            {% endif %}
          </small>
          {% endif %}
        </div>
        <div class="d-flex flex-column align-items-end">
          {% if workshop.level == 'introductory' %}
            <span class="badge badge-pill badge-success mb-1">
              <i class="fas fa-seedling"></i> Intro
            </span>
          {% elsif workshop.level == 'intermediate' %}
            <span class="badge badge-pill badge-warning mb-1">
              <i class="fas fa-layer-group"></i> Intermediate
            </span>
          {% elsif workshop.level == 'advanced' %}
            <span class="badge badge-pill badge-danger mb-1">
              <i class="fas fa-rocket"></i> Advanced
            </span>
          {% endif %}
          <div class="upcoming-session-badge"></div>
        </div>
      </div>
      
      {% if workshop.parts %}
      <div class="mb-2">
        <span class="badge badge-pill badge-light">{{ workshop.parts[0].name }}</span>
      </div>
      {% endif %}
      
      <p class="card-text text-muted flex-grow-1" style="font-size: 0.9rem; line-height: 1.4;">{{ workshop.description | truncate: 150 }}</p>
      
      <div class="mb-3">
        <small class="text-muted mb-2 d-block">
          <i class="fas fa-layer-group"></i> <strong>Builds on:</strong>
        </small>
        {% if workshop.prerequisites and workshop.prerequisites.size > 0 %}
          {% comment %} Sort prerequisites by learning path order {% endcomment %}
          {% assign sorted_prereqs = "" | split: "" %}
          
          {% comment %} First add items in Python order {% endcomment %}
          {% for ordered_item in site.data.prerequisite_order.python_order %}
            {% if workshop.prerequisites contains ordered_item %}
              {% assign sorted_prereqs = sorted_prereqs | push: ordered_item %}
            {% endif %}
          {% endfor %}
          
          {% comment %} Then add items in R order {% endcomment %}
          {% for ordered_item in site.data.prerequisite_order.r_order %}
            {% if workshop.prerequisites contains ordered_item %}
              {% assign sorted_prereqs = sorted_prereqs | push: ordered_item %}
            {% endif %}
          {% endfor %}
          
          {% comment %} Finally add any remaining items not in the predefined orders {% endcomment %}
          {% for prereq in workshop.prerequisites %}
            {% unless site.data.prerequisite_order.python_order contains prereq or site.data.prerequisite_order.r_order contains prereq %}
              {% assign sorted_prereqs = sorted_prereqs | push: prereq %}
            {% endunless %}
          {% endfor %}
          
          {% if sorted_prereqs.size > 2 %}
            <div class="prerequisites-container">
              <div class="d-flex flex-wrap" style="gap: 4px;">
                {% for prereq in sorted_prereqs limit: 2 %}
                  <span class="badge badge-secondary badge-pill" style="font-size: 0.7rem; white-space: normal; text-align: left; max-width: 100%; word-break: break-word;">{{ prereq }}</span>
                {% endfor %}
                <button class="btn btn-link btn-sm p-0 show-more-prereqs" style="font-size: 0.7rem; text-decoration: none;">
                  +{{ sorted_prereqs.size | minus: 2 }} more
                </button>
              </div>
              <div class="d-none all-prerequisites">
                <div class="d-flex flex-wrap" style="gap: 4px;">
                  {% for prereq in sorted_prereqs %}
                    <span class="badge badge-secondary badge-pill" style="font-size: 0.7rem; white-space: normal; text-align: left; max-width: 100%; word-break: break-word;">{{ prereq }}</span>
                  {% endfor %}
                </div>
                <button class="btn btn-link btn-sm p-0 show-less-prereqs" style="font-size: 0.7rem; text-decoration: none;">
                  Show less
                </button>
              </div>
            </div>
          {% else %}
            <div class="d-flex flex-wrap" style="gap: 4px;">
              {% for prereq in sorted_prereqs %}
                <span class="badge badge-secondary badge-pill" style="font-size: 0.7rem; white-space: normal; text-align: left; max-width: 100%; word-break: break-word;">{{ prereq }}</span>
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <span class="badge badge-light badge-pill" style="font-size: 0.7rem;">None!</span>
        {% endif %}
      </div>
      
      <div class="workshop-links mt-auto">
        <div class="register-button-container mb-2"></div>
        
        <div class="d-flex flex-wrap gap-2">
          <a href="{{ workshop.github_url }}" class="btn btn-sm btn-outline-primary" target="_blank" onclick="event.stopPropagation();">
            <i class="fas fa-book-open"></i> Access Materials
          </a>
          
          {% if workshop.slides_url %}
          <a href="{{ workshop.slides_url }}" class="btn btn-sm btn-outline-secondary" target="_blank" onclick="event.stopPropagation();">
            <i class="fas fa-presentation"></i> Slides
          </a>
          {% endif %}
        </div>
      </div>
    </div>
    </div>
  </a>
</div>